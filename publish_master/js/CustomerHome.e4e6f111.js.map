{"version":3,"sources":["webpack:///./src/plugins/Tmap.ts","webpack:///./src/components/PopupWithHead/index.vue?8f47","webpack:///./src/views/customer/CustomerHome.vue?5896","webpack:///./src/views/customer/CustomerHome.vue?456a","webpack:///./src/views/customer/CustomerHome.vue","webpack:///./src/views/customer/CustomerHome.vue?7451","webpack:///./src/views/customer/CustomerHome.vue?fc8a","webpack:///./src/components/PopupWithHead/index.vue","webpack:///./src/components/PopupWithHead/index.vue?765e","webpack:///./src/components/PopupWithHead/index.vue?4654","webpack:///./node_modules/core-js/modules/es.array.map.js"],"names":["MapKey","TMapGL","r","TMap","Promise","resolve","reject","script","document","createElement","type","src","onerror","onload","head","appendChild","id","class","showShopList","handleClickListBtn","shopListRef","length","item","key","handleClickShop","shopImg","alt","ShopName","distance","addr","show","showNoBind","headImg","contentText","confirmBtnText","needCloseBtn","handleCloseNoBind","showShopDetail","headImgStyle","shopDetail","showBindPopup","content","bindShop","shopId","handleClickUnbind","contactPhone","needCancelBtn","showBindSuccess","handleCloseBindSuccess","defineComponent","name","components","PopupWithHead","setup","store","useStore","router","useRouter","lat","computed","state","lng","needComplete","ref","shopLat","shopLng","iconUrl","Toast","loading","message","forbidClick","duration","initMapFlag","setTimeout","Dialog","confirm","title","closeOnClickOverlay","confirmButtonText","then","catch","markerLayer","value","shop","sortShopList","shopList","forEach","Math","floor","alert","messageAlign","push","styles","getHomeInfo","http","post","res","code","data","bindInfo","commit","console","log","pMarker","MarkerStyle","width","height","anchor","x","y","bindedStyle","cqStyle","hqStyle","markers","map","i","style","styleId","position","LatLng","properties","setStyles","add","fail","msg","err","handleBindShop","success","onClose","remove","sessionStorage","setItem","initTmap","center","Map","getElementById","minZoom","maxZoom","zoom","mapZoomType","constants","MAP_ZOOM_TYPE","CENTER","draggable","scrollable","doubleClickZoom","showControl","pitchable","rotatable","MultiMarker","geometries","on","evt","geometry","watch","nValue","oValue","onMounted","getItem","window","location","reload","render","__scopeId","showPopup","close-on-click-overlay","handleClickCancel","handleClickConfirm","props","Boolean","requrie","default","String","Object","context","emit","$","$map","arrayMethodHasSpeciesSupport","HAS_SPECIES_SUPPORT","target","proto","forced","callbackfn","this","arguments","undefined"],"mappings":"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","file":"js/CustomerHome.e4e6f111.js","sourcesContent":["export const MapKey = 'LMLBZ-V4CCP-OJEDJ-LETNS-PT7IS-HDFR6';\r\nexport function TMapGL() {\r\n    let r;\r\n    try {\r\n        if (TMap)\r\n            r = Promise.resolve();\r\n    }\r\n    catch {\r\n        r = new Promise(function (resolve, reject) {\r\n            const script = document.createElement('script');\r\n            script.type = 'text/javascript';\r\n            script.src =\r\n                'https://map.qq.com/api/gljs?v=1.exp&libraries=tools&key=' + MapKey;\r\n            script.onerror = () => reject();\r\n            script.onload = () => resolve();\r\n            document.head.appendChild(script);\r\n        });\r\n    }\r\n    return r;\r\n}\r\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=718d3164&lang=less&scoped=true\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CustomerHome.vue?vue&type=style&index=1&id=5a3f04d6&lang=less&scoped=true\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CustomerHome.vue?vue&type=style&index=0&id=5a3f04d6&lang=css\"","<template>\r\n  <div class=\"customer-home-conatainer\">\r\n    <div id=\"lbs-container\" v-show=\"!showShopList\"></div>\r\n    <div\r\n      class=\"list-btn\"\r\n      v-show=\"!showShopList\"\r\n      @click=\"handleClickListBtn\"\r\n    ></div>\r\n    <div class=\"list-container\" v-show=\"showShopList\">\r\n      <template v-if=\"shopListRef.length === 0\">\r\n        <div class=\"no-message\">\r\n          当前区域未有注册零售户，请等待当地零售户开通注册！\r\n        </div>\r\n      </template>\r\n      <ul>\r\n        <li\r\n          v-for=\"item in shopListRef\"\r\n          :key=\"item.id\"\r\n          @click=\"handleClickShop(item)\"\r\n        >\r\n          <div class=\"img\"><img :src=\"item.shopImg\" alt=\"\" /></div>\r\n          <div class=\"content\">\r\n            <div class=\"name\">\r\n              <p>{{ item.ShopName }}</p>\r\n              <span class=\"distance\">{{ item.distance }}</span>\r\n            </div>\r\n            <div class=\"addr\">{{ item.addr }}</div>\r\n          </div>\r\n          <div class=\"icon-right\"></div>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <div\r\n      class=\"lbs-btn\"\r\n      v-show=\"showShopList\"\r\n      @click=\"handleClickListBtn\"\r\n    ></div>\r\n  </div>\r\n  <popup-with-head\r\n    :show=\"showNoBind\"\r\n    headImg=\"\r\n      https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/icon-popup-head-lbs.png\r\n    \"\r\n    contentText=\"您还没有专属零售户哦！赶快去绑定吧！\"\r\n    confirmBtnText=\"选择零售户\"\r\n    needCloseBtn\r\n    @confirm=\"handleCloseNoBind\"\r\n    @cancel=\"handleCloseNoBind\"\r\n  />\r\n  <popup-with-head\r\n    :show=\"showShopDetail\"\r\n    :headImgStyle=\"{\r\n      width: '80vw',\r\n      height: '52.26667vw ',\r\n      borderRadius: '2.66667vw'\r\n    }\"\r\n    :headImg=\"shopDetail.shopImg\"\r\n    confirmBtnText=\"绑定零售户\"\r\n    needCloseBtn\r\n    @confirm=\"showBindPopup = true\"\r\n    @cancel=\"showShopDetail = false\"\r\n  >\r\n    <template #content>\r\n      <div class=\"shop-detail-container\">\r\n        <div class=\"shop-detail-title\">\r\n          {{ shopDetail.ShopName }}\r\n          <template v-if=\"bindShop\">\r\n            <span\r\n              v-if=\"bindShop.shopId === shopDetail.id\"\r\n              class=\"btn-unbind\"\r\n              @click=\"handleClickUnbind\"\r\n              >解绑零售户</span\r\n            >\r\n          </template>\r\n        </div>\r\n        <div class=\"shop-detail-content\">地址：{{ shopDetail.addr }}</div>\r\n        <div class=\"shop-detail-content\">\r\n          电话：{{ shopDetail.contactPhone }}\r\n        </div>\r\n      </div>\r\n    </template>\r\n    <div v-if=\"bindShop\"></div>\r\n  </popup-with-head>\r\n  <popup-with-head\r\n    :show=\"showBindPopup\"\r\n    headImg=\"https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/icon-debind-head.png\"\r\n    needCancelBtn\r\n    @confirm=\"\r\n      () => {\r\n        showBindPopup = false\r\n        showShopDetail = false\r\n        handleBindShop()\r\n      }\r\n    \"\r\n    @cancel=\"showBindPopup = false\"\r\n  >\r\n    <template #content>\r\n      <div class=\"bind-popup-container\">\r\n        绑定成为零售户专属粉丝后，就只能参与您当前绑定零售户店铺的互动不能在解绑了哦，您确定绑定吗？\r\n      </div>\r\n    </template>\r\n  </popup-with-head>\r\n  <popup-with-head\r\n    :show=\"showBindSuccess\"\r\n    headImg=\"https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/icon-debind-head.png\"\r\n    needCancelBtn\r\n    @confirm=\"handleCloseBindSuccess\"\r\n    @cancel=\"handleCloseBindSuccess\"\r\n  >\r\n    <template #content>\r\n      <div class=\"bind-popup-container\">\r\n        恭喜您，成为零售户专属粉丝！赶快去参与专属活动吧！\r\n      </div>\r\n    </template>\r\n  </popup-with-head>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\n// eslint-disable-next-line\r\ndeclare let TMap: any\r\nimport { computed, defineComponent, onMounted, ref, watch } from 'vue'\r\nimport { TMapGL } from '@/plugins/Tmap'\r\nimport { http } from '@/http'\r\nimport { Dialog, Toast } from 'vant'\r\nimport { useStore } from 'vuex'\r\nimport { GlobalDataProps } from '@/store'\r\nimport PopupWithHead from '@/components/PopupWithHead/index.vue'\r\nimport { useRouter } from 'vue-router'\r\n\r\ninterface ShopInfo {\r\n  id: number\r\n  shopLat: number\r\n  shopLng: number\r\n  ShopName: string\r\n  addr: string\r\n  contactPhone: string\r\n  distance: number | string\r\n  shopImg: string\r\n  iconUrl: string\r\n}\r\ninterface BindShop {\r\n  id: number\r\n  ctime: string\r\n  utime: string\r\n  rcdNote: string\r\n  shopId: number\r\n  openid: string\r\n  unionid: string\r\n  bindChannel: number\r\n  wxmpSyncTime: string\r\n  fanNickName: string | null\r\n  fanHeadImg: string | null\r\n  fanGender: number | null\r\n  fanMobile: string | null\r\n  birthday: string | null\r\n}\r\n\r\nexport default defineComponent({\r\n  name: 'CustomerHome',\r\n  components: { PopupWithHead },\r\n  setup() {\r\n    const store = useStore<GlobalDataProps>()\r\n    const router = useRouter()\r\n    const lat = computed(() => store.state.lat)\r\n    const lng = computed(() => store.state.lng)\r\n    const needComplete = computed(() => store.state.needComplete)\r\n    const shopListRef = ref<ShopInfo[]>([])\r\n    const bindShop = ref<BindShop | null>(null)\r\n\r\n    const showShopList = ref(false)\r\n    const showNoBind = ref(false)\r\n    const showBindPopup = ref(false)\r\n    const showShopDetail = ref(false)\r\n    const showBindSuccess = ref(false)\r\n\r\n    const shopDetail = ref<ShopInfo>({\r\n      id: 0,\r\n      shopImg: '',\r\n      ShopName: '',\r\n      contactPhone: '',\r\n      addr: '',\r\n      shopLat: 0,\r\n      shopLng: 0,\r\n      distance: 0,\r\n      iconUrl: ''\r\n    })\r\n\r\n    Toast.loading({\r\n      message: '加载中...',\r\n      forbidClick: true,\r\n      duration: 10000\r\n    })\r\n\r\n    let initMapFlag = false\r\n\r\n    setTimeout(() => {\r\n      if (!initMapFlag) {\r\n        Dialog.confirm({\r\n          title: '提示',\r\n          message:\r\n            '尊敬的用户，获取您的地理位置信息失败，请重新进入或刷新本页面。',\r\n          closeOnClickOverlay: true,\r\n          confirmButtonText: '知道了'\r\n        })\r\n          .then(() => {\r\n            // on confirm\r\n          })\r\n          .catch(() => {\r\n            // on cancel\r\n          })\r\n      }\r\n    }, 11000)\r\n\r\n    const handleClickListBtn = () => {\r\n      showShopList.value = !showShopList.value\r\n    }\r\n\r\n    const handleClickShop = (shop: ShopInfo) => {\r\n      shopDetail.value.id = shop.id\r\n      shopDetail.value.shopImg = shop.shopImg\r\n      shopDetail.value.ShopName = shop.ShopName\r\n      shopDetail.value.contactPhone = shop.contactPhone\r\n      shopDetail.value.addr = shop.addr\r\n      shopDetail.value.shopLat = shop.shopLat\r\n      shopDetail.value.shopLng = shop.shopLng\r\n      shopDetail.value.distance = shop.distance\r\n      showShopDetail.value = true\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    let markerLayer: any\r\n\r\n    const sortShopList = (shopList: ShopInfo[]) => {\r\n      shopList.forEach((item) => {\r\n        if (item.distance > 1000) {\r\n          item.distance =\r\n            Math.floor(((item.distance as number) / 1000) * 100) / 100 + 'km'\r\n        } else {\r\n          item.distance = Math.floor(item.distance as number) + 'm'\r\n        }\r\n      })\r\n      return shopList\r\n    }\r\n    const handleCloseBindSuccess = () => {\r\n      showBindSuccess.value = false\r\n      if (needComplete.value === true) {\r\n        Dialog.alert({\r\n          title: '提示',\r\n          message:\r\n            '赶快前往本平台个人中心完善您的性别、电话、生日等信息吧，未完善信息无法参与本平台的相关活动哦~',\r\n          messageAlign: 'left',\r\n          closeOnClickOverlay: false\r\n        }).then(() => {\r\n          // on close\r\n          router.push('/customer/userInfo')\r\n        })\r\n      }\r\n    }\r\n    interface Styles {\r\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n      [key: string]: any\r\n    }\r\n    let styles: Styles = {}\r\n    const getHomeInfo = (lat: number, lng: number) => {\r\n      http\r\n        .post('/hbSeller/fans/homeInfo', { lat, lng }, false)\r\n        .then((res) => {\r\n          if (res.code === '200') {\r\n            const { bindInfo, shopList } = res.data\r\n            // 店铺绑定信息\r\n            if (!bindInfo) {\r\n              showNoBind.value = true\r\n              store.commit('setBindShopFlag', false)\r\n            } else {\r\n              bindShop.value = bindInfo as BindShop\r\n              store.commit('setBindShopFlag', true)\r\n            }\r\n            //  当前区域未有注册零售户\r\n            if (shopList === null || shopList.length === 0) {\r\n              //  已绑定店铺\r\n              if (showNoBind.value !== true) {\r\n                Dialog.confirm({\r\n                  title: '提示',\r\n                  message: '当前区域未有注册零售户，请等待当地零售户开通注册。',\r\n                  closeOnClickOverlay: true,\r\n                  confirmButtonText: '知道了'\r\n                })\r\n                  .then(() => {\r\n                    // on confirm\r\n                    if (needComplete.value) {\r\n                      handleCloseBindSuccess()\r\n                    }\r\n                  })\r\n                  .catch(() => {\r\n                    // on cancel\r\n                    if (needComplete.value) {\r\n                      handleCloseBindSuccess()\r\n                    }\r\n                  })\r\n              }\r\n            } else {\r\n              console.log(needComplete.value, !showNoBind.value)\r\n              if (\r\n                needComplete.value &&\r\n                !showNoBind.value &&\r\n                !showBindSuccess.value\r\n              ) {\r\n                handleCloseBindSuccess()\r\n              }\r\n            }\r\n            if (shopList && shopList.length) {\r\n              shopListRef.value = sortShopList(shopList)\r\n              styles = {\r\n                pMarker: new TMap.MarkerStyle({\r\n                  width: 20, // 样式宽\r\n                  height: 30, // 样式高\r\n                  anchor: { x: 10, y: 30 } // 描点位置\r\n                }),\r\n                bindedStyle: new TMap.MarkerStyle({\r\n                  width: 47, // 点标记样式宽度（像素）\r\n                  height: 40, // 点标记样式高度（像素）\r\n                  src:\r\n                    'https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/lbs-icon-seller-binded.png', //图片路径\r\n                  //焦点在图片中的像素位置，一般大头针类似形式的图片以针尖位置做为焦点，圆形点以圆心位置为焦点\r\n                  anchor: { x: 16, y: 32 }\r\n                }),\r\n                cqStyle: new TMap.MarkerStyle({\r\n                  width: 47, // 点标记样式宽度（像素）\r\n                  height: 40, // 点标记样式高度（像素）\r\n                  src:\r\n                    'https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/lbs-icon-seller-cq.png', //图片路径\r\n                  //焦点在图片中的像素位置，一般大头针类似形式的图片以针尖位置做为焦点，圆形点以圆心位置为焦点\r\n                  anchor: { x: 16, y: 32 }\r\n                }),\r\n                hqStyle: new TMap.MarkerStyle({\r\n                  width: 47, // 点标记样式宽度（像素）\r\n                  height: 40, // 点标记样式高度（像素）\r\n                  src:\r\n                    'https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/lbs-icon-seller-hq.png', //图片路径\r\n                  //焦点在图片中的像素位置，一般大头针类似形式的图片以针尖位置做为焦点，圆形点以圆心位置为焦点\r\n                  anchor: { x: 16, y: 32 }\r\n                })\r\n              }\r\n              const markers = shopList.map((i: ShopInfo) => {\r\n                const style = `style${i.id}`\r\n                styles[style] = new TMap.MarkerStyle({\r\n                  width: 47, // 点标记样式宽度（像素）\r\n                  height: 40, // 点标记样式高度（像素）\r\n                  src: i.iconUrl, //图片路径\r\n                  //焦点在图片中的像素位置，一般大头针类似形式的图片以针尖位置做为焦点，圆形点以圆心位置为焦点\r\n                  anchor: { x: 16, y: 32 }\r\n                })\r\n\r\n                return {\r\n                  id: i.id, //点标记唯一标识，后续如果有删除、修改位置等操作，都需要此id\r\n                  styleId:\r\n                    bindShop.value?.shopId === i.id ? 'bindedStyle' : style, //指定样式id\r\n                  position: new TMap.LatLng(i.shopLat, i.shopLng), //点标记坐标位置\r\n                  properties: {\r\n                    //自定义属性\r\n                    id: i.id,\r\n                    title: i.ShopName,\r\n                    ShopName: i.ShopName,\r\n                    addr: i.addr,\r\n                    contactPhone: i.contactPhone,\r\n                    distance: i.distance,\r\n                    shopImg: i.shopImg,\r\n                    shopLat: i.shopLat,\r\n                    shopLng: i.shopLng\r\n                  }\r\n                }\r\n              })\r\n              markers.push({\r\n                id: 0, //点标记唯一标识，后续如果有删除、修改位置等操作，都需要此id\r\n                styleId: 'pMarker', //指定样式id\r\n                position: new TMap.LatLng(lat, lng) //点标记坐标位置\r\n              })\r\n              markerLayer.setStyles(styles)\r\n              markerLayer.add(markers)\r\n            } else {\r\n              const markers = []\r\n              markers.push({\r\n                id: 0, //点标记唯一标识，后续如果有删除、修改位置等操作，都需要此id\r\n                styleId: 'pMarker', //指定样式id\r\n                position: new TMap.LatLng(lat, lng) //点标记坐标位置\r\n              })\r\n              markerLayer.setStyles(styles)\r\n              markerLayer.add(markers)\r\n            }\r\n          } else {\r\n            Toast.fail(res.msg)\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n        })\r\n    }\r\n    const handleCloseNoBind = () => {\r\n      showNoBind.value = false\r\n      if (shopListRef.value.length === 0) {\r\n        Dialog.confirm({\r\n          title: '提示',\r\n          message: '当前区域未有注册零售户，请等待当地零售户开通注册。',\r\n          closeOnClickOverlay: true,\r\n          confirmButtonText: '知道了'\r\n        })\r\n          .then(() => {\r\n            // on confirm\r\n          })\r\n          .catch(() => {\r\n            // on cancel\r\n          })\r\n      }\r\n    }\r\n\r\n    const handleBindShop = () => {\r\n      http\r\n        .post('/hbSeller/fans/bindShop', { shopId: shopDetail.value.id }, false)\r\n        .then((res) => {\r\n          if (res.code === '200') {\r\n            Toast.success({\r\n              message: '绑定成功',\r\n              onClose: () => {\r\n                markerLayer.remove(shopListRef.value.map((i) => i.id))\r\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                getHomeInfo(lat.value!, lng.value!)\r\n              }\r\n            })\r\n            const needComplete = res.data.needComplete as boolean\r\n            store.commit('setNeedComplete', res.data.needComplete)\r\n            if (needComplete) {\r\n              sessionStorage.setItem('needComplete', '1')\r\n            } else {\r\n              sessionStorage.setItem('needComplete', '0')\r\n            }\r\n            showBindSuccess.value = true\r\n          } else {\r\n            Toast.fail(res.msg)\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n        })\r\n    }\r\n\r\n    const handleClickUnbind = () => {\r\n      Dialog.confirm({\r\n        title: '提示',\r\n        messageAlign: 'left',\r\n        message:\r\n          '尊敬的用户，解绑零售户，需在公众号留言“解绑零售户”，由客服人员后台操作处理，解绑前需领取未领取的奖品，如已领取请忽略，绑定关系解除后，已产生的相关活动数据会中断，需重新绑定零售户后参与店铺活动。',\r\n        closeOnClickOverlay: true,\r\n        confirmButtonText: '知道了'\r\n      })\r\n        .then(() => {\r\n          // on confirm\r\n        })\r\n        .catch(() => {\r\n          // on cancel\r\n        })\r\n    }\r\n\r\n    const initTmap = () => {\r\n      TMapGL().then(() => {\r\n        console.log(lat.value, lng.value)\r\n        initMapFlag = true\r\n        const center = new TMap.LatLng(lat.value, lng.value)\r\n        const map = new TMap.Map(document.getElementById('lbs-container'), {\r\n          center: center, //  设置地图中心点坐标\r\n          minZoom: 11,\r\n          maxZoom: 13,\r\n          zoom: 13,\r\n          mapZoomType: TMap.constants.MAP_ZOOM_TYPE.CENTER, //  根据地图中心点缩放（移动端和PC端）\r\n          draggable: false, //  是否支持拖拽移动地图，默认为true。\r\n          scrollable: true, // 是否支持鼠标滚轮缩放地图，默认为true\r\n          doubleClickZoom: false, // 是否支持双击缩放地图，默认为true。\r\n          showControl: false, // 是否显示地图上的控件，默认true。\r\n          pitchable: false, // 是否允许设置俯仰角度；默认为true。在2D视图下，此属性无效。\r\n          rotatable: false // 是否允许设置旋转角度；默认为true。在2D视图下，此属性无效。\r\n        })\r\n        //初始marker样式\r\n        markerLayer = new TMap.MultiMarker({\r\n          id: 'marker-layer',\r\n          map: map,\r\n          geometries: []\r\n        })\r\n\r\n        //监听标注点击事件\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        markerLayer.on('click', function(evt: any) {\r\n          console.log(evt.geometry)\r\n          handleClickShop(evt.geometry.properties as ShopInfo)\r\n        })\r\n\r\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n        getHomeInfo(lat.value!, lng.value!)\r\n      })\r\n    }\r\n\r\n    watch(\r\n      () => lat.value,\r\n      (nValue, oValue) => {\r\n        if (lat.value && lng.value && oValue == null) {\r\n          initTmap()\r\n        }\r\n      }\r\n    )\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      store.commit('setLng', 116.70602)\r\n      store.commit('setLat', 39.860464)\r\n    }\r\n    onMounted(() => {\r\n      if (process.env.NODE_ENV === 'production') {\r\n        if (lat.value && lng.value) {\r\n          initTmap()\r\n          return\r\n        }\r\n      }\r\n      if (!sessionStorage.getItem('CustomerHome')) {\r\n        sessionStorage.setItem('CustomerHome', '1')\r\n        window.location.reload()\r\n        return\r\n      }\r\n    })\r\n\r\n    return {\r\n      showShopList,\r\n      showNoBind,\r\n      showBindPopup,\r\n      shopListRef,\r\n      showShopDetail,\r\n      showBindSuccess,\r\n      shopDetail,\r\n      bindShop,\r\n      handleClickListBtn,\r\n      handleClickShop,\r\n      handleBindShop,\r\n      handleClickUnbind,\r\n      handleCloseNoBind,\r\n      handleCloseBindSuccess\r\n    }\r\n  }\r\n})\r\n</script>\r\n<style>\r\n.van-dialog__message--left {\r\n  text-align: justify;\r\n}\r\n</style>\r\n<style lang=\"less\" scoped>\r\n@import '@/theme/common';\r\n.customer-home-conatainer {\r\n  position: relative;\r\n  height: 100%;\r\n  #lbs-container {\r\n    /*地图(容器)显示大小*/\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n  .list-container {\r\n    padding-top: 10px;\r\n    margin: 0 10px;\r\n    box-sizing: border-box;\r\n    .no-message {\r\n      position: relative;\r\n      top: 200px;\r\n      line-height: 30px;\r\n      text-align: center;\r\n      font-size: 14px;\r\n      color: #b1b1b1;\r\n    }\r\n    ul {\r\n      li {\r\n        display: flex;\r\n        height: 100px;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        background: #fff;\r\n        padding: 12px;\r\n        box-sizing: border-box;\r\n        border-radius: 5px;\r\n        margin-bottom: 10px;\r\n        .img {\r\n          margin-right: 12px;\r\n          img {\r\n            display: block;\r\n            width: 75px;\r\n            height: 75px;\r\n          }\r\n        }\r\n        .content {\r\n          flex: 1;\r\n          .name {\r\n            width: 200px;\r\n            height: 20px;\r\n            font-size: 16px;\r\n            line-height: 20px;\r\n            color: #303133;\r\n            margin-bottom: 22px;\r\n\r\n            p {\r\n              width: 140px;\r\n              float: left;\r\n              overflow: hidden;\r\n              text-overflow: ellipsis;\r\n              white-space: nowrap;\r\n            }\r\n            .distance {\r\n              float: right;\r\n              font-size: 12px;\r\n              color: #b1b1b1;\r\n              margin-left: 12px;\r\n              text-align: right;\r\n            }\r\n          }\r\n          .addr {\r\n            width: 195px;\r\n            height: 17px;\r\n            font-size: 14px;\r\n            line-height: 17px;\r\n            color: #606266;\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n          }\r\n        }\r\n        .icon-right {\r\n          .bg-img(\r\n            10px,\r\n            16px,\r\n            'https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/personal/iconfont-go.png'\r\n          );\r\n          filter: contrast(0.5);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .list-btn {\r\n    .bg-img(\r\n      53px,\r\n      53px,\r\n      'https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/icon-group-lbs.png'\r\n    );\r\n    position: absolute;\r\n    top: 10px;\r\n    right: 10px;\r\n    z-index: 1003;\r\n  }\r\n  .lbs-btn {\r\n    .bg-img(\r\n      53px,\r\n      53px,\r\n      'https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/icon-group-list.png'\r\n    );\r\n    position: fixed;\r\n    top: 10px;\r\n    right: 10px;\r\n    z-index: 1003;\r\n  }\r\n}\r\n.shop-detail-container {\r\n  padding-top: 110px;\r\n  margin: 0 17px -8vw;\r\n  box-sizing: border-box;\r\n  .shop-detail-title {\r\n    height: 27px;\r\n    font-size: 20px;\r\n    font-weight: bold;\r\n    line-height: 27px;\r\n    color: #303133;\r\n    margin-bottom: 6px;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    white-space: nowrap;\r\n    .btn-unbind {\r\n      float: right;\r\n      width: 67px;\r\n      height: 26px;\r\n      background: rgba(32, 105, 255, 0.06);\r\n      border: 1px solid #2069ff;\r\n      line-height: 26px;\r\n      text-align: center;\r\n      color: #2069ff;\r\n      font-size: 12px;\r\n      border-radius: 5px;\r\n      box-sizing: border-box;\r\n    }\r\n  }\r\n  .shop-detail-content {\r\n    height: 27px;\r\n    font-size: 14px;\r\n    line-height: 27px;\r\n    color: #303133;\r\n    margin-bottom: 6px;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    white-space: nowrap;\r\n  }\r\n}\r\n.bind-popup-container {\r\n  margin: 108px 24px -15px;\r\n  font-size: 14px;\r\n  line-height: 24px;\r\n  color: #303133;\r\n  text-align: justify;\r\n}\r\n</style>\r\n","import { computed, defineComponent, onMounted, ref, watch } from 'vue';\r\nimport { TMapGL } from '@/plugins/Tmap';\r\nimport { http } from '@/http';\r\nimport Dialog from \"vant/es/dialog\";\r\nimport \"vant/es/dialog/style/less\";\r\nimport Toast from \"vant/es/toast\";\r\nimport \"vant/es/toast/style/less\";\r\nimport { useStore } from 'vuex';\r\nimport PopupWithHead from '@/components/PopupWithHead/index.vue';\r\nimport { useRouter } from 'vue-router';\r\nexport default defineComponent({\r\n    name: 'CustomerHome',\r\n    components: { PopupWithHead },\r\n    setup() {\r\n        const store = useStore();\r\n        const router = useRouter();\r\n        const lat = computed(() => store.state.lat);\r\n        const lng = computed(() => store.state.lng);\r\n        const needComplete = computed(() => store.state.needComplete);\r\n        const shopListRef = ref([]);\r\n        const bindShop = ref(null);\r\n        const showShopList = ref(false);\r\n        const showNoBind = ref(false);\r\n        const showBindPopup = ref(false);\r\n        const showShopDetail = ref(false);\r\n        const showBindSuccess = ref(false);\r\n        const shopDetail = ref({\r\n            id: 0,\r\n            shopImg: '',\r\n            ShopName: '',\r\n            contactPhone: '',\r\n            addr: '',\r\n            shopLat: 0,\r\n            shopLng: 0,\r\n            distance: 0,\r\n            iconUrl: ''\r\n        });\r\n        Toast.loading({\r\n            message: '加载中...',\r\n            forbidClick: true,\r\n            duration: 10000\r\n        });\r\n        let initMapFlag = false;\r\n        setTimeout(() => {\r\n            if (!initMapFlag) {\r\n                Dialog.confirm({\r\n                    title: '提示',\r\n                    message: '尊敬的用户，获取您的地理位置信息失败，请重新进入或刷新本页面。',\r\n                    closeOnClickOverlay: true,\r\n                    confirmButtonText: '知道了'\r\n                })\r\n                    .then(() => {\r\n                    // on confirm\r\n                })\r\n                    .catch(() => {\r\n                    // on cancel\r\n                });\r\n            }\r\n        }, 11000);\r\n        const handleClickListBtn = () => {\r\n            showShopList.value = !showShopList.value;\r\n        };\r\n        const handleClickShop = (shop) => {\r\n            shopDetail.value.id = shop.id;\r\n            shopDetail.value.shopImg = shop.shopImg;\r\n            shopDetail.value.ShopName = shop.ShopName;\r\n            shopDetail.value.contactPhone = shop.contactPhone;\r\n            shopDetail.value.addr = shop.addr;\r\n            shopDetail.value.shopLat = shop.shopLat;\r\n            shopDetail.value.shopLng = shop.shopLng;\r\n            shopDetail.value.distance = shop.distance;\r\n            showShopDetail.value = true;\r\n        };\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        let markerLayer;\r\n        const sortShopList = (shopList) => {\r\n            shopList.forEach((item) => {\r\n                if (item.distance > 1000) {\r\n                    item.distance =\r\n                        Math.floor((item.distance / 1000) * 100) / 100 + 'km';\r\n                }\r\n                else {\r\n                    item.distance = Math.floor(item.distance) + 'm';\r\n                }\r\n            });\r\n            return shopList;\r\n        };\r\n        const handleCloseBindSuccess = () => {\r\n            showBindSuccess.value = false;\r\n            if (needComplete.value === true) {\r\n                Dialog.alert({\r\n                    title: '提示',\r\n                    message: '赶快前往本平台个人中心完善您的性别、电话、生日等信息吧，未完善信息无法参与本平台的相关活动哦~',\r\n                    messageAlign: 'left',\r\n                    closeOnClickOverlay: false\r\n                }).then(() => {\r\n                    // on close\r\n                    router.push('/customer/userInfo');\r\n                });\r\n            }\r\n        };\r\n        let styles = {};\r\n        const getHomeInfo = (lat, lng) => {\r\n            http\r\n                .post('/hbSeller/fans/homeInfo', { lat, lng }, false)\r\n                .then((res) => {\r\n                if (res.code === '200') {\r\n                    const { bindInfo, shopList } = res.data;\r\n                    // 店铺绑定信息\r\n                    if (!bindInfo) {\r\n                        showNoBind.value = true;\r\n                        store.commit('setBindShopFlag', false);\r\n                    }\r\n                    else {\r\n                        bindShop.value = bindInfo;\r\n                        store.commit('setBindShopFlag', true);\r\n                    }\r\n                    //  当前区域未有注册零售户\r\n                    if (shopList === null || shopList.length === 0) {\r\n                        //  已绑定店铺\r\n                        if (showNoBind.value !== true) {\r\n                            Dialog.confirm({\r\n                                title: '提示',\r\n                                message: '当前区域未有注册零售户，请等待当地零售户开通注册。',\r\n                                closeOnClickOverlay: true,\r\n                                confirmButtonText: '知道了'\r\n                            })\r\n                                .then(() => {\r\n                                // on confirm\r\n                                if (needComplete.value) {\r\n                                    handleCloseBindSuccess();\r\n                                }\r\n                            })\r\n                                .catch(() => {\r\n                                // on cancel\r\n                                if (needComplete.value) {\r\n                                    handleCloseBindSuccess();\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                    else {\r\n                        console.log(needComplete.value, !showNoBind.value);\r\n                        if (needComplete.value &&\r\n                            !showNoBind.value &&\r\n                            !showBindSuccess.value) {\r\n                            handleCloseBindSuccess();\r\n                        }\r\n                    }\r\n                    if (shopList && shopList.length) {\r\n                        shopListRef.value = sortShopList(shopList);\r\n                        styles = {\r\n                            pMarker: new TMap.MarkerStyle({\r\n                                width: 20,\r\n                                height: 30,\r\n                                anchor: { x: 10, y: 30 } // 描点位置\r\n                            }),\r\n                            bindedStyle: new TMap.MarkerStyle({\r\n                                width: 47,\r\n                                height: 40,\r\n                                src: 'https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/lbs-icon-seller-binded.png',\r\n                                //焦点在图片中的像素位置，一般大头针类似形式的图片以针尖位置做为焦点，圆形点以圆心位置为焦点\r\n                                anchor: { x: 16, y: 32 }\r\n                            }),\r\n                            cqStyle: new TMap.MarkerStyle({\r\n                                width: 47,\r\n                                height: 40,\r\n                                src: 'https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/lbs-icon-seller-cq.png',\r\n                                //焦点在图片中的像素位置，一般大头针类似形式的图片以针尖位置做为焦点，圆形点以圆心位置为焦点\r\n                                anchor: { x: 16, y: 32 }\r\n                            }),\r\n                            hqStyle: new TMap.MarkerStyle({\r\n                                width: 47,\r\n                                height: 40,\r\n                                src: 'https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/lbs-icon-seller-hq.png',\r\n                                //焦点在图片中的像素位置，一般大头针类似形式的图片以针尖位置做为焦点，圆形点以圆心位置为焦点\r\n                                anchor: { x: 16, y: 32 }\r\n                            })\r\n                        };\r\n                        const markers = shopList.map((i) => {\r\n                            const style = `style${i.id}`;\r\n                            styles[style] = new TMap.MarkerStyle({\r\n                                width: 47,\r\n                                height: 40,\r\n                                src: i.iconUrl,\r\n                                //焦点在图片中的像素位置，一般大头针类似形式的图片以针尖位置做为焦点，圆形点以圆心位置为焦点\r\n                                anchor: { x: 16, y: 32 }\r\n                            });\r\n                            return {\r\n                                id: i.id,\r\n                                styleId: bindShop.value?.shopId === i.id ? 'bindedStyle' : style,\r\n                                position: new TMap.LatLng(i.shopLat, i.shopLng),\r\n                                properties: {\r\n                                    //自定义属性\r\n                                    id: i.id,\r\n                                    title: i.ShopName,\r\n                                    ShopName: i.ShopName,\r\n                                    addr: i.addr,\r\n                                    contactPhone: i.contactPhone,\r\n                                    distance: i.distance,\r\n                                    shopImg: i.shopImg,\r\n                                    shopLat: i.shopLat,\r\n                                    shopLng: i.shopLng\r\n                                }\r\n                            };\r\n                        });\r\n                        markers.push({\r\n                            id: 0,\r\n                            styleId: 'pMarker',\r\n                            position: new TMap.LatLng(lat, lng) //点标记坐标位置\r\n                        });\r\n                        markerLayer.setStyles(styles);\r\n                        markerLayer.add(markers);\r\n                    }\r\n                    else {\r\n                        const markers = [];\r\n                        markers.push({\r\n                            id: 0,\r\n                            styleId: 'pMarker',\r\n                            position: new TMap.LatLng(lat, lng) //点标记坐标位置\r\n                        });\r\n                        markerLayer.setStyles(styles);\r\n                        markerLayer.add(markers);\r\n                    }\r\n                }\r\n                else {\r\n                    Toast.fail(res.msg);\r\n                }\r\n            })\r\n                .catch((err) => {\r\n                console.log(err);\r\n            });\r\n        };\r\n        const handleCloseNoBind = () => {\r\n            showNoBind.value = false;\r\n            if (shopListRef.value.length === 0) {\r\n                Dialog.confirm({\r\n                    title: '提示',\r\n                    message: '当前区域未有注册零售户，请等待当地零售户开通注册。',\r\n                    closeOnClickOverlay: true,\r\n                    confirmButtonText: '知道了'\r\n                })\r\n                    .then(() => {\r\n                    // on confirm\r\n                })\r\n                    .catch(() => {\r\n                    // on cancel\r\n                });\r\n            }\r\n        };\r\n        const handleBindShop = () => {\r\n            http\r\n                .post('/hbSeller/fans/bindShop', { shopId: shopDetail.value.id }, false)\r\n                .then((res) => {\r\n                if (res.code === '200') {\r\n                    Toast.success({\r\n                        message: '绑定成功',\r\n                        onClose: () => {\r\n                            markerLayer.remove(shopListRef.value.map((i) => i.id));\r\n                            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                            getHomeInfo(lat.value, lng.value);\r\n                        }\r\n                    });\r\n                    const needComplete = res.data.needComplete;\r\n                    store.commit('setNeedComplete', res.data.needComplete);\r\n                    if (needComplete) {\r\n                        sessionStorage.setItem('needComplete', '1');\r\n                    }\r\n                    else {\r\n                        sessionStorage.setItem('needComplete', '0');\r\n                    }\r\n                    showBindSuccess.value = true;\r\n                }\r\n                else {\r\n                    Toast.fail(res.msg);\r\n                }\r\n            })\r\n                .catch((err) => {\r\n                console.log(err);\r\n            });\r\n        };\r\n        const handleClickUnbind = () => {\r\n            Dialog.confirm({\r\n                title: '提示',\r\n                messageAlign: 'left',\r\n                message: '尊敬的用户，解绑零售户，需在公众号留言“解绑零售户”，由客服人员后台操作处理，解绑前需领取未领取的奖品，如已领取请忽略，绑定关系解除后，已产生的相关活动数据会中断，需重新绑定零售户后参与店铺活动。',\r\n                closeOnClickOverlay: true,\r\n                confirmButtonText: '知道了'\r\n            })\r\n                .then(() => {\r\n                // on confirm\r\n            })\r\n                .catch(() => {\r\n                // on cancel\r\n            });\r\n        };\r\n        const initTmap = () => {\r\n            TMapGL().then(() => {\r\n                console.log(lat.value, lng.value);\r\n                initMapFlag = true;\r\n                const center = new TMap.LatLng(lat.value, lng.value);\r\n                const map = new TMap.Map(document.getElementById('lbs-container'), {\r\n                    center: center,\r\n                    minZoom: 11,\r\n                    maxZoom: 13,\r\n                    zoom: 13,\r\n                    mapZoomType: TMap.constants.MAP_ZOOM_TYPE.CENTER,\r\n                    draggable: false,\r\n                    scrollable: true,\r\n                    doubleClickZoom: false,\r\n                    showControl: false,\r\n                    pitchable: false,\r\n                    rotatable: false // 是否允许设置旋转角度；默认为true。在2D视图下，此属性无效。\r\n                });\r\n                //初始marker样式\r\n                markerLayer = new TMap.MultiMarker({\r\n                    id: 'marker-layer',\r\n                    map: map,\r\n                    geometries: []\r\n                });\r\n                //监听标注点击事件\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                markerLayer.on('click', function (evt) {\r\n                    console.log(evt.geometry);\r\n                    handleClickShop(evt.geometry.properties);\r\n                });\r\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                getHomeInfo(lat.value, lng.value);\r\n            });\r\n        };\r\n        watch(() => lat.value, (nValue, oValue) => {\r\n            if (lat.value && lng.value && oValue == null) {\r\n                initTmap();\r\n            }\r\n        });\r\n        if (process.env.NODE_ENV !== 'production') {\r\n            store.commit('setLng', 116.70602);\r\n            store.commit('setLat', 39.860464);\r\n        }\r\n        onMounted(() => {\r\n            if (process.env.NODE_ENV === 'production') {\r\n                if (lat.value && lng.value) {\r\n                    initTmap();\r\n                    return;\r\n                }\r\n            }\r\n            if (!sessionStorage.getItem('CustomerHome')) {\r\n                sessionStorage.setItem('CustomerHome', '1');\r\n                window.location.reload();\r\n                return;\r\n            }\r\n        });\r\n        return {\r\n            showShopList,\r\n            showNoBind,\r\n            showBindPopup,\r\n            shopListRef,\r\n            showShopDetail,\r\n            showBindSuccess,\r\n            shopDetail,\r\n            bindShop,\r\n            handleClickListBtn,\r\n            handleClickShop,\r\n            handleBindShop,\r\n            handleClickUnbind,\r\n            handleCloseNoBind,\r\n            handleCloseBindSuccess\r\n        };\r\n    }\r\n});\r\n","import { render } from \"./CustomerHome.vue?vue&type=template&id=5a3f04d6&scoped=true\"\nimport script from \"./CustomerHome.vue?vue&type=script&lang=ts\"\nexport * from \"./CustomerHome.vue?vue&type=script&lang=ts\"\n\nimport \"./CustomerHome.vue?vue&type=style&index=0&id=5a3f04d6&lang=css\"\nimport \"./CustomerHome.vue?vue&type=style&index=1&id=5a3f04d6&lang=less&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-5a3f04d6\"\n\nexport default script","<template>\r\n  <van-popup\r\n    v-model:show=\"showPopup\"\r\n    :close-on-click-overlay=\"false\"\r\n    style=\"border-radius:2.6vw;background-color: unset;\"\r\n  >\r\n    <img class=\"popup-icon\" :src=\"headImg\" :style=\"headImgStyle\" alt=\"\" />\r\n    <div class=\"popup-container\">\r\n      <slot name=\"content\">\r\n        <div class=\"text\">{{ contentText }}</div>\r\n      </slot>\r\n      <div class=\"btns\">\r\n        <slot name=\"default\">\r\n          <template v-if=\"needCancelBtn\">\r\n            <div class=\"light\" @click=\"handleClickCancel\">取消</div>\r\n            <div class=\"plain\" @click=\"handleClickConfirm\">确定</div>\r\n          </template>\r\n          <template v-else>\r\n            <div class=\"plain no-cancel\" @click=\"handleClickConfirm\">\r\n              {{ confirmBtnText }}\r\n            </div>\r\n          </template>\r\n        </slot>\r\n      </div>\r\n    </div>\r\n    <template v-if=\"needCloseBtn\">\r\n      <div class=\"btn-close\" @click=\"handleClickCancel\">\r\n        <img\r\n          src=\"https://qrmkt.oss-cn-beijing.aliyuncs.com/hbseller_client/Close.png\"\r\n          alt=\"\"\r\n        />\r\n      </div>\r\n    </template>\r\n  </van-popup>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent, ref, watch } from 'vue'\r\n\r\nexport default defineComponent({\r\n  name: 'PopupWithHead',\r\n  props: {\r\n    show: {\r\n      type: Boolean,\r\n      requrie: true,\r\n      default: false\r\n    },\r\n    headImg: {\r\n      type: String,\r\n      requrie: true,\r\n      default: ''\r\n    },\r\n    headImgStyle: {\r\n      type: Object || null,\r\n      requrie: false,\r\n      default: null\r\n    },\r\n    needCancelBtn: {\r\n      type: Boolean,\r\n      requrie: true,\r\n      default: false\r\n    },\r\n    contentText: {\r\n      type: String,\r\n      requrie: false,\r\n      default: ''\r\n    },\r\n    confirmBtnText: {\r\n      type: String,\r\n      requrie: true,\r\n      default: '确定'\r\n    },\r\n    needCloseBtn: {\r\n      type: Boolean,\r\n      requrie: false,\r\n      default: false\r\n    }\r\n  },\r\n  setup(props, context) {\r\n    const showPopup = ref(props.show)\r\n    watch(\r\n      () => props.show,\r\n      () => {\r\n        showPopup.value = props.show\r\n      }\r\n    )\r\n    const handleClickConfirm = () => {\r\n      context.emit('confirm')\r\n    }\r\n    const handleClickCancel = () => {\r\n      context.emit('cancel')\r\n    }\r\n\r\n    return {\r\n      showPopup,\r\n      handleClickConfirm,\r\n      handleClickCancel\r\n    }\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.popup-container {\r\n  width: 300px;\r\n  height: 280px;\r\n  margin-top: -98px;\r\n  background-color: #fff;\r\n  border-radius: 10px;\r\n  overflow: hidden;\r\n  .text {\r\n    margin-top: 130px;\r\n    height: 28px;\r\n    font-size: 17px;\r\n    text-align: center;\r\n    line-height: 28px;\r\n    color: #303133;\r\n  }\r\n  .btns {\r\n    margin: 44px 44px 0;\r\n    .light {\r\n      float: left;\r\n      width: 100px;\r\n      height: 44px;\r\n      line-height: 44px;\r\n      font-size: 16px;\r\n      border: 1px solid #0180ff;\r\n      text-align: center;\r\n      border-radius: 4px;\r\n      color: #0180ff;\r\n      box-sizing: border-box;\r\n    }\r\n    .plain {\r\n      float: right;\r\n      width: 100px;\r\n      height: 44px;\r\n      line-height: 44px;\r\n      font-size: 16px;\r\n      text-align: center;\r\n      background: #0271fd;\r\n      border-radius: 4px;\r\n      color: #fff;\r\n      &.no-cancel {\r\n        width: 100%;\r\n      }\r\n    }\r\n  }\r\n}\r\n.popup-icon {\r\n  display: block;\r\n  width: 115px;\r\n  height: 115px;\r\n  margin: 0 auto;\r\n}\r\n.btn-close {\r\n  img {\r\n    display: block;\r\n    width: 30px;\r\n    height: 30px;\r\n    margin: 30px auto 0;\r\n  }\r\n}\r\n</style>\r\n","import { defineComponent, ref, watch } from 'vue';\r\nexport default defineComponent({\r\n    name: 'PopupWithHead',\r\n    props: {\r\n        show: {\r\n            type: Boolean,\r\n            requrie: true,\r\n            default: false\r\n        },\r\n        headImg: {\r\n            type: String,\r\n            requrie: true,\r\n            default: ''\r\n        },\r\n        headImgStyle: {\r\n            type: Object || null,\r\n            requrie: false,\r\n            default: null\r\n        },\r\n        needCancelBtn: {\r\n            type: Boolean,\r\n            requrie: true,\r\n            default: false\r\n        },\r\n        contentText: {\r\n            type: String,\r\n            requrie: false,\r\n            default: ''\r\n        },\r\n        confirmBtnText: {\r\n            type: String,\r\n            requrie: true,\r\n            default: '确定'\r\n        },\r\n        needCloseBtn: {\r\n            type: Boolean,\r\n            requrie: false,\r\n            default: false\r\n        }\r\n    },\r\n    setup(props, context) {\r\n        const showPopup = ref(props.show);\r\n        watch(() => props.show, () => {\r\n            showPopup.value = props.show;\r\n        });\r\n        const handleClickConfirm = () => {\r\n            context.emit('confirm');\r\n        };\r\n        const handleClickCancel = () => {\r\n            context.emit('cancel');\r\n        };\r\n        return {\r\n            showPopup,\r\n            handleClickConfirm,\r\n            handleClickCancel\r\n        };\r\n    }\r\n});\r\n","import { render } from \"./index.vue?vue&type=template&id=718d3164&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=ts\"\nexport * from \"./index.vue?vue&type=script&lang=ts\"\n\nimport \"./index.vue?vue&type=style&index=0&id=718d3164&lang=less&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-718d3164\"\n\nexport default script","'use strict';\nvar $ = require('../internals/export');\nvar $map = require('../internals/array-iteration').map;\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('map');\n\n// `Array.prototype.map` method\n// https://tc39.es/ecma262/#sec-array.prototype.map\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT }, {\n  map: function map(callbackfn /* , thisArg */) {\n    return $map(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n"],"sourceRoot":""}